programa TP3Ej4_quitarFloresDeESquina_10_10_FINAL
procesos
  proceso enviarIds
  comenzar
    EnviarMensaje(1,robot1)
    EnviarMensaje(2,robot2)
    EnviarMensaje(3,robot3)  
    EnviarMensaje(4,robot4)
  fin
  proceso colaborar (E quien: numero;ES termine:boolean;ES junte:numero;E aveOrigen:numero;E calleOrigen:numero)
  comenzar
    BloquearEsquina (10,10)
    Pos (10,10)
    si HayFlorEnLaEsquina
      tomarFlor
      junte:=junte+1
      BloquearEsquina (11,11)
      Pos (11,11)
      LiberarEsquina(10,10)
      depositarFlor
      Pos (aveOrigen,calleOrigen)
      LiberarEsquina (11,11)
    sino
      EnviarMensaje(quien,jefe)
      EnviarMensaje(junte,jefe)
      termine:=V
      Pos (aveOrigen,calleOrigen)
      LiberarEsquina(10,10)
  fin
  proceso vaciarEsq_11_11JEFE(E flores:numero){Quita las flores depositadas de esq 10,10}
  comenzar  {No quita las que habia antes}
    Pos (11,11)
    repetir flores
      tomarFlor
    Pos (1,1)
  fin
areas
  esquinaAVaciar: AreaC (10,10,10,10)
  esquinaDeposito: AreaC (11,11,11,11)
  areaJefe: AreaP (1,1,1,1)
  areaRobot1: AreaP (9,9,9,9)
  areaRobot2: AreaP (9,10,9,10)
  areaRobot3: AreaP (9,11,9,11)
  areaRobot4: AreaP (9,12,9,12)
robots
  robot tipoCompetidor
  variables
    quienSoy,flores,aveOrigen,calleOrigen: numero
    termine: boolean
  comenzar
    aveOrigen:=PosAv
    calleOrigen:=PosCa
    termine:=F
    flores:=0
    RecibirMensaje (quienSoy,jefe)
    mientras (~termine)   
      colaborar (quienSoy,termine,flores,aveOrigen,calleOrigen)
  fin
  robot tipoJefe
  variables
    quien,finalizaron,totalFlores,flores:numero
  comenzar
    enviarIds
    finalizaron:=0
    totalFlores:=0
    repetir 4
      RecibirMensaje(quien,*)
      si (quien=1)
        RecibirMensaje(flores,robot1)
      sino
        si (quien=2)
          RecibirMensaje(flores,robot2)
        sino
          si (quien=3)
            RecibirMensaje(flores,robot3)
          sino
            RecibirMensaje(flores,robot4)
      totalFlores:=totalFlores+flores
    Informar ('Ultimo_en_finalizar',quien)
    vaciarEsq_11_11JEFE(totalFlores)
  fin
variables
  robot1,robot2,robot3,robot4: tipoCompetidor
  jefe: tipoJefe
comenzar
  AsignarArea (robot1,esquinaAVaciar )
  AsignarArea (robot2, esquinaAVaciar)
  AsignarArea (robot3, esquinaAVaciar)
  AsignarArea (robot4, esquinaAVaciar)
  AsignarArea (robot1,esquinaDeposito )
  AsignarArea (robot2, esquinaDeposito)
  AsignarArea (robot3, esquinaDeposito)
  AsignarArea (robot4, esquinaDeposito)
  AsignarArea (robot1, areaRobot1)
  AsignarArea (robot2, areaRobot2)
  AsignarArea (robot3, areaRobot3)
  AsignarArea (robot4, areaRobot4)
  AsignarArea (jefe, areaJefe)
  AsignarArea (jefe, esquinaDeposito)
  Iniciar (jefe, 1,1 )
  Iniciar (robot1, 9,9 )
  Iniciar (robot2, 9,10)
  Iniciar (robot3, 9,11 )
  Iniciar (robot4, 9,12)
fin